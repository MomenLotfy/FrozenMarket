<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>الملف الشخصي - فروزن ماركت</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script typodule" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nome src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
  <style>
    :root {
      --primary-blue: #183c6e;
      --primary-yellow: #ffff00;
      --light-gray: #f8f9fa;
      --text-dark: #333;
      --primary-color: #3a6cf4;
      --secondary-color: #ff9d3c;
      --accent-color: #ff5e7d;
      --text-color: #2c3e50;
      --light-bg: #f8f9fa;
      --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
      --hover-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      --border-radius: 16px;
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--light-gray);
      color: var(--text-dark);
      line-height: 1.6;
    }

      /* Mobile Bottom Navigation */
.mobile-bottom-nav {
    display: none; /* افتراضياً مخفي */
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.15);
    z-index: 1000;
    padding: 10px 10px;
    display: flex; /* نخليها مرنة */
}

/* العناصر */
.bottom-nav-item {
    flex: 1;
    text-align: center;
    padding-left: 30px;
    padding-right: 30px;
    text-decoration: none;
    color: var(--text-dark);
    transition: all 0.3s ease;
    position: relative;
}

.bottom-nav-item:hover,
.bottom-nav-item.active {
    color: var(--primary-blue);
    transform: translateY(-2px);
}

.bottom-nav-item ion-icon {
    font-size: 1.5rem;
    display: block;
    margin-bottom: 5px;
    transition: all 0.3s ease;
}

.bottom-nav-item span {
    font-size: 0.8rem;
    font-weight: 600;
}

/* Mobile cart badge (افتراضي) */
.mobile-cart-count {
    position: absolute;
    top: -6px;
    right: 45%;
    background: #ffff00;
    color: #183c6e;
    font-size: 0.7rem;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
    transition: all 0.3s ease;
}

/* للشاشات الصغيرة جداً (موبايل أقل من 480px) */
@media (max-width: 480px) {
  .mobile-cart-count {
    right: 65%;   /* نقلها شوية بعيد عن الأيقونة */
    top: -6px;    /* رفعها لفوق */
    font-size: 0.6rem;  /* تصغير النص */
    padding: 1px 5px;   /* تصغير البادينج */
  }
}
/* Sidebar */
.sidebar {
    position: fixed;
    top: 0;
    right: -280px; /* يبدأ من اليمين مخفي */
    width: 280px;
    height: 100%;
    background: #fff;
    transition: right 0.3s ease;
    z-index: 1001;
    padding: 20px;
    direction: rtl;
}

.sidebar.active {
    right: 0;
}

.sidebar-title {
    font-size: 20px;
    margin-bottom: 15px;
    color: #183c6e;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
}

.sidebar-links a {
    display: block;
    padding: 10px 0;
    font-size: 16px;
    color: #183c6e;
    text-decoration: none;
    transition: 0.2s;
}
.sidebar-links a i {
    margin-left: 8px;
}


.sidebar-text {
    margin-top: 20px;
    padding: 15px;
    background: #f9f9f9;
    border-radius: 10px;
    text-align: center;
}
.sidebar-text h3 {
    margin-bottom: 10px;
    color: #222;
}
.sidebar-text p {
    font-size: 14px;
    color: #555;
}

.sidebar-social {
    margin-top: 20px;
    text-align: center;
}
.sidebar-social p {
    margin-bottom: 10px;
    font-weight: bold;
    color: #333;
}
.sidebar-social a {
    display: inline-block;
            width: 50px;
            height: 50px;
            text-align: center;
            line-height: 50px;
            border-radius: 50%;
            margin: 0 10px;
            transition: all 0.3s ease;
            font-size: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
}
.sidebar-social a:hover {
   transform: translateY(-5px) scale(1.1);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
}
.sidebar-social a.facebook {
            color: #0249cc;
        }

.sidebar-social a.whatsapp {
            color: #25D366;
        }

/* Overlay */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    display: none;
    z-index: 1000;
}
.overlay.active {
    display: block;
}




/* ✅ إظهار الناف بار بس على الموبايل والتابلت */
@media (max-width: 1024px) {
    .mobile-bottom-nav {
        display: flex;
    }
}

@media (min-width: 1025px) {
    .mobile-bottom-nav {
        display: none;
    }
}



    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background-color: white;
      box-shadow: var(--card-shadow);
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-blue);
      text-decoration: none;
    }

    .user-header {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: var(--primary-blue);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      transition: var(--transition);
    }

    .back-btn,
    .logout-btn {
      background: #6c757d;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
      text-decoration: none;
    }

    .back-btn {
      background: var(--primary-blue);
    }

    .back-btn:hover {
      background: #132a4e;
    }

    .logout-btn {
      background: #dc3545;
    }

    .logout-btn:hover {
      background: #c82333;
    }

    .profile-tabs {
      display: flex;
      background-color: white;
      margin: 20px 0;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--card-shadow);
    }

    .tab {
      padding: 15px 25px;
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
      flex: 1;
      border-bottom: 3px solid transparent;
    }

    .tab:hover {
      background-color: rgba(24, 60, 110, 0.05);
    }

    .tab.active {
      border-bottom: 3px solid var(--primary-yellow);
      color: var(--primary-blue);
      font-weight: bold;
      background-color: rgba(255, 255, 0, 0.1);
    }

    .tab-content {
      display: none;
      background-color: white;
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      margin-bottom: 20px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .tab-content.active {
      display: block;
    }

    .tab-content h2 {
      color: var(--primary-blue);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--light-gray);
    }

    .profile-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .info-card {
      background-color: white;
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      border: 1px solid #eee;
    }

    .info-card h3 {
      margin-bottom: 15px;
      color: var(--primary-blue);
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-card h3 i {
      color: var(--primary-yellow);
    }

    .info-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px dashed #eee;
      direction: rtl;
    }

    .info-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
      direction: rtl;
    }

    .order-card {
      border: 1px solid #eee;
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 20px;
      background-color: white;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .order-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: bold;
    }

    .status-delivered {
      background-color: rgba(46, 125, 50, 0.1);
      color: #2e7d32;
    }

    .status-pending {
      background-color: rgba(255, 193, 7, 0.1);
      color: #ff8f00;
    }

    .status-cancelled {
      background-color: rgba(220, 53, 69, 0.1);
      color: #c62828;
    }

    .order-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }

    .order-items {
      margin-top: 15px;
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px dotted #eee;
    }

    .order-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .settings-form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: var(--primary-blue);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      transition: var(--transition);
      direction: rtl;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(24, 60, 110, 0.1);
      outline: none;
      direction: rtl;
    }

    .btn {
      padding: 12px 25px;
      background-color: var(--primary-blue);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      background-color: #132a4e;
    }

    .notification-item {
      display: flex;
      align-items: center;
      padding: 15px;
      border-bottom: 1px solid #eee;
      transition: var(--transition);
      background: white;
      margin-bottom: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }

    .notification-item:hover {
      background-color: #f9f9f9;
    }

    .notification-icon {
      margin-left: 15px;
      font-size: 20px;
      color: var(--primary-blue);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(24, 60, 110, 0.1);
      border-radius: 50%;
    }

    .notification-content {
      flex: 1;
      margin-left: 15px;
    }

    .notification-title {
      font-weight: bold;
      color: var(--text-dark);
      margin-bottom: 5px;
    }

    .notification-text {
      color: #666;
      font-size: 14px;
      line-height: 1.4;
    }

    .notification-time {
      color: #999;
      font-size: 12px;
      margin-top: 5px;
    }

    .notification-actions {
      display: flex;
      gap: 10px;
    }

    .delete-notification {
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
      transition: var(--transition);
    }

    .delete-notification:hover {
      background: #c82333;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
      border-left: 4px solid #28a745;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
      border-left: 4px solid #dc3545;
    }

    .no-orders {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .no-orders i {
      font-size: 48px;
      color: #ddd;
      margin-bottom: 15px;
    }

    .no-notifications {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .no-notifications i {
      font-size: 48px;
      color: #ddd;
      margin-bottom: 15px;
    }

    .form-check {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .form-check-input {
      width: 18px;
      height: 18px;
      accent-color: var(--primary-blue);
    }

    .form-check-label {
      margin-bottom: 0;
      font-weight: normal;
    }

    
    @media (max-width: 768px) {
      .profile-info,
      .settings-form {
        grid-template-columns: 1fr;
      }

      .profile-tabs {
        flex-direction: column;
      }

      .order-details {
        grid-template-columns: 1fr;
      }

      .user-header {
        flex-direction: column;
        gap: 10px;
        text-align: center;
      }

      .nav-container {
        flex-direction: column;
        gap: 15px;
      }

      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .tab {
        padding: 12px;
      }

      .notification-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .notification-actions {
        align-self: flex-end;
      }
    }
  </style>
</head>
<body>
    <!-- Mobile Bottom Navigation -->
<div class="mobile-bottom-nav">
    <a href="#" id="openSidebar" class="bottom-nav-item">
        <ion-icon name="grid-outline"></ion-icon>
    </a>
    
   <a href="Cart.html" class="bottom-nav-item position-relative">
    <ion-icon name="cart-outline"></ion-icon>
    <span id="mobile-cart-count" class="mobile-cart-count">0</span>
</a>

    
    <a href="../index.html" class="bottom-nav-item active">
        <ion-icon name="home-outline"></ion-icon>
    </a>
    
    <a href="wishlist.html" class="bottom-nav-item">
        <ion-icon name="heart-outline"></ion-icon>
    </a>
    
    <a href="signup&signup.html" class="bottom-nav-item">
        <ion-icon name="person-outline"></ion-icon>
    </a>
</div>



<!-- Sidebar (RTL) -->
<div id="sidebar" class="sidebar">
    <div class="sidebar-content">
        <h2 class="sidebar-title">الأقسام</h2>
        <nav class="sidebar-links">
            <a href="products.html#honey"><i class="fas fa-jar"></i> العسل</a>
            <a href="products.html#butter"><i class="fas fa-cheese"></i> الزبدة</a>
            <a href="products.html#mozzarella"><i class="fas fa-pizza-slice"></i> الموتزاريلا</a>
            <a href="products.html#nuts"><i class="fas fa-seedling"></i> المكسرات</a>
            <a href="products.html#chicken"><i class="fas fa-drumstick-bite"></i> الفراخ</a>
            <a href="products.html#meat"><i class="fas fa-hotdog"></i> اللحوم</a>
            <a href="products.html#fish"><i class="fas fa-fish"></i> الأسماك</a>
        </nav>

        <div class="sidebar-text">
            <h3>فروزن ماركت</h3>
            <p>نسعى لتقديم أفضل المنتجات الطازجة والعالية الجودة لعملائنا الكرام بأسعار مناسبة وخدمة متميزة.</p>
        </div>

        <div class="sidebar-social">
            <p>تابعنا</p>
            <a href="https://www.facebook.com/share/1CBX1XvNHf/" class="facebook" title="فيسبوك">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://wa.me/201008064581" class="whatsapp" title="واتساب">
                            <i class="fab fa-whatsapp"></i>
                        </a>
        </div>
    </div>
</div>

<!-- Overlay -->
<div id="overlay" class="overlay"></div>


  <header>
    <div class="nav-container">
      <a href="../index.html" class="logo">فروزن ماركت</a>
      <div class="user-header">
        <a href="../index.html" class="back-btn">
          <i class="fas fa-arrow-right"></i> العودة للرئيسية
        </a>
        <button class="logout-btn" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> تسجيل الخروج
        </button>
        <div>
          <div id="userName">اسم العميل</div>
          <small id="userSince">عميل منذ: -</small>
        </div>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="profile-tabs">
      <div class="tab active" data-tab="profile">البيانات الشخصية</div>
      <div class="tab" data-tab="orders">طلباتي</div>
      <div class="tab" data-tab="settings">الإعدادات</div>
      <div class="tab" data-tab="notifications">الإشعارات</div>
    </div>

    <!-- البيانات الشخصية -->
    <div class="tab-content active" id="profile">
      <h2><i class="fas fa-user"></i> البيانات الشخصية</h2>
      <div class="profile-info">
        <div class="info-card">
          <h3><i class="fas fa-info-circle"></i> المعلومات الأساسية</h3>
          <div class="info-item"><span>الاسم الكامل:</span><span id="profileName">-</span></div>
          <div class="info-item"><span>البريد الإلكتروني:</span><span id="profileEmail">-</span></div>
          <div class="info-item"><span>رقم الهاتف:</span><span id="profilePhone">-</span></div>
          <div class="info-item"><span>تاريخ التسجيل:</span><span id="profileRegisterDate">-</span></div>
        </div>

        <div class="info-card">
          <h3><i class="fas fa-map-marker-alt"></i> عنوان التوصيل</h3>
          <div class="info-item"><span>العنوان الرئيسي:</span><span id="profileAddress">-</span></div>
        </div>

        <div class="info-card">
          <h3><i class="fas fa-chart-line"></i> الإحصائيات</h3>
          <div class="info-item"><span>عدد الطلبات:</span><span id="profileOrdersCount">0 طلب</span></div>
          <div class="info-item"><span>إجمالي المشتريات:</span><span id="profileTotalSpent">0 جنيه</span></div>
          <div class="info-item"><span>آخر طلب:</span><span id="profileLastOrder">-</span></div>
        </div>
      </div>
    </div>

    <!-- الطلبات -->
    <div class="tab-content" id="orders">
      <h2><i class="fas fa-shopping-bag"></i> تاريخ الطلبات</h2>
      <div id="ordersContainer">
        <div class="no-orders">
          <i class="fas fa-shopping-cart"></i>
          <p>لا توجد طلبات حتى الآن</p>
        </div>
      </div>
    </div>
    
    <!-- قسم الإعدادات -->
    <div class="tab-content" id="settings">
      <h2><i class="fas fa-cog"></i> الإعدادات والتفضيلات</h2>
      
      <div class="settings-form">
        <div>
          <h3><i class="fas fa-user-edit"></i> المعلومات الشخصية</h3>
          <form id="personalInfoForm">
            <div class="form-group">
              <label for="settingsName">الاسم الكامل</label>
              <input type="text" id="settingsName" required>
            </div>
            <div class="form-group">
              <label for="settingsEmail">البريد الإلكتروني</label>
              <input type="email" id="settingsEmail" required>
            </div>
            <div class="form-group">
              <label for="settingsPhone">رقم الهاتف</label>
              <input type="tel" id="settingsPhone">
            </div>
            <button type="submit" class="btn"><i class="fas fa-save"></i> حفظ التغييرات</button>
            <div id="personalInfoMessage"></div>
          </form>
        </div>
        
        <div>
          <h3><i class="fas fa-truck"></i> إعدادات التوصيل</h3>
          <form id="deliverySettingsForm">
            <div class="form-group">
              <label for="settingsAddress">العنوان الرئيسي</label>
              <input type="text" id="settingsAddress" placeholder="مثال: شارع جامع العمري أمام محل البقالة">
            </div>
            <div class="form-group">
              <label for="settingsDeliveryPref">تفضيلات أوقات التوصيل</label>
              <select id="settingsDeliveryPref">
                <option value="any-time">أي وقت</option>
                <option value="8-10">من 8 صباحاً إلى 10 صباحاً</option>
                <option value="10-12">من 10 صباحاً إلى 12 ظهراً</option>
                <option value="12-2">من 12 ظهراً إلى 2 مساءً</option>
                <option value="2-4">من 2 مساءً إلى 4 مساءً</option>
                <option value="4-6">من 4 مساءً إلى 6 مساءً</option>
                <option value="6-8">من 6 مساءً إلى 8 مساءً</option>
                <option value="8-10">من 8 مساءً إلى 10 مساءً</option>
              </select>
            </div>
            <button type="submit" class="btn"><i class="fas fa-save"></i> حفظ التغييرات</button>
            <div id="deliverySettingsMessage"></div>
          </form>
        </div>
        
        <div>
          <h3><i class="fas fa-bell"></i> إعدادات الإشعارات</h3>
          <form id="notificationSettingsForm">
            <div class="form-check">
              <input type="checkbox" id="notifyPromotional" class="form-check-input">
              <label for="notifyPromotional" class="form-check-label">العروض الترويجية</label>
            </div>
            <div class="form-check">
              <input type="checkbox" id="notifyOrderStatus" class="form-check-input">
              <label for="notifyOrderStatus" class="form-check-label">تنبيهات حالة الطلب</label>
            </div>
            <button type="submit" class="btn"><i class="fas fa-save"></i> حفظ التغييرات</button>
            <div id="notificationSettingsMessage"></div>
          </form>
        </div>
      </div>
    </div>

    <!-- قسم الإشعارات -->
    <div class="tab-content" id="notifications">
      <h2><i class="fas fa-bell"></i> الإشعارات</h2>
      <div id="notificationsContainer">
        <!-- سيتم ملء الإشعارات هنا ديناميكياً -->
      </div>
    </div>
  </div>

      
<script>
document.addEventListener("DOMContentLoaded", function () {
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const openBtn = document.getElementById("openSidebar");
  const links   = document.querySelectorAll("#sidebar .sidebar-links a");

  // فتح
  openBtn.addEventListener("click", function (e) {
    e.preventDefault();
    sidebar.classList.add("active");
    overlay.classList.add("active");
  });

  // غلق
  function closeSidebar() {
    sidebar.classList.remove("active");
    overlay.classList.remove("active");
  }

  overlay.addEventListener("click", closeSidebar);

  // غلق عند الضغط على أي لينك
  links.forEach(link => {
    link.addEventListener("click", () => {
      closeSidebar();
    });
  });
});
</script>
  <!-- Firebase SDK -->
  <script type="module">
   // Firebase SDK
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { 
  getAuth, 
  onAuthStateChanged, 
  signOut, 
  updateProfile,
  connectAuthEmulator 
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
import { 
  getFirestore, 
  doc, 
  getDoc, 
  collection, 
  getDocs, 
  updateDoc, 
  deleteDoc,
  query, 
  where, 
  orderBy,
  serverTimestamp,
  connectFirestoreEmulator 
} from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyCFk_WlW4qHcSbsLSHeWUTfGsc5W0FSE8A",
  authDomain: "frozenmarket-5c9df.firebaseapp.com",
  projectId: "frozenmarket-5c9df",
  storageBucket: "frozenmarket-5c9df.firebasestorage.app",
  messagingSenderId: "847658049541",
  appId: "1:847658049541:web:6f4cd551a12d5e45b5bc6c",
  measurementId: "G-32ZC3B3KPT"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// تفعيل وضع المحاكاة للاختبار
const useEmulator = false;
if (useEmulator && window.location.hostname === "localhost") {
  try {
    connectAuthEmulator(auth, "http://localhost:9099");
    connectFirestoreEmulator(db, "localhost", 8080);
    console.log("Firebase Emulator connected for ProfilePage");
  } catch (error) {
    console.error("Failed to connect to emulator:", error);
  }
}

let currentUser = null;
let userData = null;
let isDataLoaded = false;
let redirectInProgress = false;

// دالة لعرض الرسائل
function showMessage(elementId, message, type = 'success') {
  const element = document.getElementById(elementId);
  if (element) {
    element.innerHTML = `<div class="${type === 'success' ? 'success-message' : 'error-message'}">${message}</div>`;
    setTimeout(() => {
      element.innerHTML = '';
    }, 5000);
  }
}

// دالة لمعالجة الأخطاء
function getErrorMessage(errorCode) {
  const errorMessages = {
    'permission-denied': 'لا يوجد صلاحية للوصول لهذه البيانات',
    'not-found': 'البيانات المطلوبة غير موجودة',
    'unavailable': 'الخدمة غير متاحة حالياً، حاول مرة أخرى',
    'unauthenticated': 'يجب تسجيل الدخول أولاً',
    'network-request-failed': 'خطأ في الاتصال بالإنترنت'
  };
  
  return errorMessages[errorCode] || 'حدث خطأ غير متوقع، حاول مرة أخرى';
}

// دالة تحميل بيانات المستخدم من Firestore
async function loadUserData(user) {
  try {
    console.log('Loading user data for:', user.uid);
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);

    if (userSnap.exists()) {
      userData = userSnap.data();
      console.log('User data loaded:', userData);
      
      // تحديث عرض اسم المستخدم في الهيدر
      const userNameElement = document.getElementById("userName");
      const userSinceElement = document.getElementById("userSince");
      
      if (userNameElement) {
        userNameElement.textContent = userData.name || user.displayName || user.email;
      }
      
      if (userSinceElement) {
        userSinceElement.textContent = "عميل منذ: " + (userData.registerDate || "-");
      }

      // تحديث البيانات الشخصية
      updateElementText("profileName", userData.name || user.displayName || "-");
      updateElementText("profileEmail", userData.email || user.email);
      updateElementText("profilePhone", userData.phone || "-");
      updateElementText("profileRegisterDate", userData.registerDate || "-");

      // العنوان
      updateElementText("profileAddress", userData.addresses?.primary || "-");

      // الإحصائيات
      updateElementText("profileOrdersCount", (userData.stats?.ordersCount || 0) + " طلب");
      updateElementText("profileTotalSpent", (userData.stats?.totalSpent || 0) + " جنيه");
      updateElementText("profileLastOrder", userData.stats?.lastOrderAt || "-");

      // تعبئة نماذج الإعدادات
      updateInputValue("settingsName", userData.name || user.displayName || "");
      updateInputValue("settingsEmail", userData.email || user.email);
      updateInputValue("settingsPhone", userData.phone || "");
      updateInputValue("settingsAddress", userData.addresses?.primary || "");
      updateSelectValue("settingsDeliveryPref", userData.preferences?.deliveryTime || "any-time");

      // إعدادات الإشعارات
      updateCheckboxValue("notifyPromotional", userData.preferences?.notifications?.promotional === true);
      updateCheckboxValue("notifyOrderStatus", userData.preferences?.notifications?.orderStatus !== false);

      // إضافة رابط لوحة التحكم للأدمن
      addAdminLinkIfAdmin(userData);

      isDataLoaded = true;
    } else {
      console.log("No user document found, creating basic profile");
      await createBasicUserProfile(user);
    }
  } catch (error) {
    console.error("Error loading user data:", error);
    showMessage('personalInfoMessage', 'حدث خطأ في تحميل البيانات: ' + getErrorMessage(error.code), 'error');
  }
}

// دالة مساعدة لتحديث النصوص
function updateElementText(elementId, text) {
  const element = document.getElementById(elementId);
  if (element) {
    element.textContent = text;
  }
}

// دالة مساعدة لتحديث قيم الحقول
function updateInputValue(elementId, value) {
  const element = document.getElementById(elementId);
  if (element) {
    element.value = value;
  }
}

// دالة مساعدة لتحديث قيم Select
function updateSelectValue(elementId, value) {
  const element = document.getElementById(elementId);
  if (element) {
    element.value = value;
  }
}

// دالة مساعدة لتحديث Checkbox
function updateCheckboxValue(elementId, checked) {
  const element = document.getElementById(elementId);
  if (element) {
    element.checked = checked;
  }
}

// دالة إضافة رابط لوحة التحكم للأدمن
function addAdminLinkIfAdmin(userData) {
  const existingAdminLink = document.querySelector('.admin-link');
  if (existingAdminLink) {
    existingAdminLink.remove();
  }

  if (userData.role === "admin") {
    const userHeader = document.querySelector(".user-header");
    if (userHeader) {
      const adminLink = document.createElement("a");
      adminLink.href = "AdminPanel.html";
      adminLink.textContent = "لوحة التحكم";
      adminLink.className = "admin-link";
      adminLink.style.cssText = `
        background: var(--secondary-color);
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 600;
        transition: var(--transition);
        margin-right: 10px;
      `;
      
      adminLink.addEventListener('mouseover', () => {
        adminLink.style.background = '#e6831d';
      });
      
      adminLink.addEventListener('mouseout', () => {
        adminLink.style.background = 'var(--secondary-color)';
      });

      const logoutBtn = userHeader.querySelector('.logout-btn');
      if (logoutBtn) {
        userHeader.insertBefore(adminLink, logoutBtn);
      } else {
        userHeader.appendChild(adminLink);
      }
    }
  }
}

// دالة إنشاء ملف المستخدم الأساسي
async function createBasicUserProfile(user) {
  try {
    const userRef = doc(db, "users", user.uid);
    const basicProfile = {
      uid: user.uid,
      name: user.displayName || "مستخدم جديد",
      email: user.email,
      phone: "",
      photoURL: user.photoURL || "",
      role: "user",
      registerDate: new Date().toLocaleDateString('ar-EG'),
      createdAt: serverTimestamp(),
      lastLoginAt: serverTimestamp(),
      stats: {
        ordersCount: 0,
        totalSpent: 0,
        lastOrderAt: null
      },
      addresses: {
        primary: "",
        secondary: ""
      },
      preferences: {
        deliveryTime: "any-time",
        notifications: {
          promotional: false,
          orderStatus: true
        }
      }
    };

    await updateDoc(userRef, basicProfile);
    userData = basicProfile;
    console.log("Basic user profile created");
  } catch (error) {
    console.error("Error creating basic user profile:", error);
  }
}

// دالة تحميل الطلبات الخاصة بالمستخدم
async function loadOrders(user) {
  try {
    console.log('Loading orders for user:', user.uid);
    
    const ordersRef = collection(db, "orders");
    const q = query(
      ordersRef,
      where("userId", "==", user.uid),
      orderBy("createdAt", "desc")
    );

    const ordersSnap = await getDocs(q);
    const ordersContainer = document.getElementById("ordersContainer");

    if (!ordersContainer) {
      console.error("Orders container not found");
      return;
    }

    if (ordersSnap.empty) {
      ordersContainer.innerHTML = `
        <div class="no-orders">
          <i class="fas fa-shopping-cart"></i>
          <p>لا توجد طلبات حتى الآن</p>
        </div>
      `;
      return;
    }

    ordersContainer.innerHTML = "";

    ordersSnap.forEach((docSnapshot) => {
      const order = docSnapshot.data();
      const orderId = docSnapshot.id;

      const statusClass = getOrderStatusClass(order.status);
      const statusText = getOrderStatusText(order.status);
      const orderDate = formatOrderDate(order);

      const orderCard = createOrderCard(order, orderId, statusClass, statusText, orderDate);
      ordersContainer.appendChild(orderCard);
    });

    console.log(`Loaded ${ordersSnap.size} orders`);
  } catch (error) {
    console.error("Error loading orders:", error);
    const ordersContainer = document.getElementById("ordersContainer");
    if (ordersContainer) {
      ordersContainer.innerHTML = `
        <div class="no-orders">
          <p style="color: red;">حدث خطأ في تحميل الطلبات: ${getErrorMessage(error.code)}</p>
        </div>
      `;
    }
  }
}

// دالة تحميل الإشعارات
async function loadNotifications(user) {
  try {
    console.log('Loading notifications for user:', user.uid);
    
    const notificationsRef = collection(db, "notifications");
    const q = query(
      notificationsRef,
      where("userId", "==", user.uid),
      orderBy("createdAt", "desc")
    );

    const notificationsSnap = await getDocs(q);
    const notificationsContainer = document.getElementById("notificationsContainer");

    if (!notificationsContainer) {
      console.error("Notifications container not found");
      return;
    }

    if (notificationsSnap.empty) {
      notificationsContainer.innerHTML = `
        <div class="no-notifications">
          <i class="fas fa-bell-slash"></i>
          <p>لا توجد إشعارات حالياً</p>
        </div>
      `;
      return;
    }

    notificationsContainer.innerHTML = "";

    notificationsSnap.forEach((docSnapshot) => {
      const notification = docSnapshot.data();
      const notificationId = docSnapshot.id;

      const notificationCard = createNotificationCard(notification, notificationId);
      notificationsContainer.appendChild(notificationCard);
    });

    console.log(`Loaded ${notificationsSnap.size} notifications`);
  } catch (error) {
    console.error("Error loading notifications:", error);
    const notificationsContainer = document.getElementById("notificationsContainer");
    if (notificationsContainer) {
      notificationsContainer.innerHTML = `
        <div class="no-notifications">
          <p style="color: red;">حدث خطأ في تحميل الإشعارات: ${getErrorMessage(error.code)}</p>
        </div>
      `;
    }
  }
}

// دالة إنشاء كارد الإشعار
function createNotificationCard(notification, notificationId) {
  const card = document.createElement("div");
  card.classList.add("notification-item");
  
  const notificationDate = formatNotificationDate(notification);
  const iconClass = getNotificationIcon(notification.type);

  card.innerHTML = `
    <div class="notification-icon">
      <i class="${iconClass}"></i>
    </div>
    <div class="notification-content">
      <div class="notification-title">${notification.title || 'إشعار'}</div>
      <div class="notification-text">${notification.message || notification.text || ''}</div>
      <div class="notification-time">${notificationDate}</div>
    </div>
    <div class="notification-actions">
      <button class="delete-notification" onclick="deleteNotification('${notificationId}')">
        <i class="fas fa-trash"></i> حذف
      </button>
    </div>
  `;

  return card;
}

// دالة حذف الإشعار
window.deleteNotification = async function(notificationId) {
  if (!confirm('هل تريد حذف هذا الإشعار؟')) {
    return;
  }

  try {
    await deleteDoc(doc(db, "notifications", notificationId));
    
    // إزالة الإشعار من الواجهة
    const notificationElement = document.querySelector(`[onclick="deleteNotification('${notificationId}')"]`).closest('.notification-item');
    if (notificationElement) {
      notificationElement.remove();
    }

    // التحقق إذا لم تعد هناك إشعارات
    const remainingNotifications = document.querySelectorAll('.notification-item');
    if (remainingNotifications.length === 0) {
      const notificationsContainer = document.getElementById("notificationsContainer");
      notificationsContainer.innerHTML = `
        <div class="no-notifications">
          <i class="fas fa-bell-slash"></i>
          <p>لا توجد إشعارات حالياً</p>
        </div>
      `;
    }

    console.log('Notification deleted successfully');
  } catch (error) {
    console.error('Error deleting notification:', error);
    alert('حدث خطأ أثناء حذف الإشعار: ' + getErrorMessage(error.code));
  }
};

// دالة تحديد أيقونة الإشعار
function getNotificationIcon(type) {
  switch (type) {
    case 'order':
      return 'fas fa-shopping-bag';
    case 'promotion':
      return 'fas fa-tag';
    case 'system':
      return 'fas fa-info-circle';
    case 'warning':
      return 'fas fa-exclamation-triangle';
    default:
      return 'fas fa-bell';
  }
}

// دالة تنسيق تاريخ الإشعار
function formatNotificationDate(notification) {
  try {
    let date;
    if (notification.createdAt && typeof notification.createdAt.toDate === "function") {
      date = notification.createdAt.toDate();
    } else if (notification.timestamp) {
      date = new Date(notification.timestamp);
    } else if (notification.createdAt) {
      date = new Date(notification.createdAt);
    } else {
      return "غير معروف";
    }
    
    const now = new Date();
    const diffTime = Math.abs(now - date);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 1) {
      return "اليوم";
    } else if (diffDays === 2) {
      return "أمس";
    } else if (diffDays <= 7) {
      return `منذ ${diffDays - 1} أيام`;
    } else {
      return date.toLocaleDateString("ar-EG", {
        year: "numeric",
        month: "long",
        day: "numeric"
      });
    }
  } catch (error) {
    console.error("Error formatting notification date:", error);
    return "غير معروف";
  }
}

// باقي الدوال المساعدة للطلبات
function getOrderStatusClass(status) {
  if (status === "تم التوصيل" || status === "delivered") {
    return "status-delivered";
  } else if (status === "قيد التجهيز" || status === "pending" || status === "processing") {
    return "status-pending";
  } else {
    return "status-cancelled";
  }
}

function getOrderStatusText(status) {
  const statusMapping = {
    "delivered": "تم التوصيل",
    "pending": "قيد التجهيز",
    "processing": "قيد المعالجة",
    "cancelled": "ملغي",
    "shipped": "تم الشحن"
  };
  
  return statusMapping[status] || status || "قيد المعالجة";
}

function formatOrderDate(order) {
  let orderDate = "غير معروف";
  
  try {
    if (order.createdAt && typeof order.createdAt.toDate === "function") {
      const date = order.createdAt.toDate();
      orderDate = date.toLocaleDateString("ar-EG", {
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit"
      });
    } else if (order.timestamp) {
      const date = new Date(order.timestamp);
      orderDate = date.toLocaleDateString("ar-EG", {
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit"
      });
    } else if (order.orderDate) {
      orderDate = order.orderDate;
    }
  } catch (error) {
    console.error("Error formatting date:", error);
  }
  
  return orderDate;
}

function createOrderCard(order, orderId, statusClass, statusText, orderDate) {
  const card = document.createElement("div");
  card.classList.add("order-card");
  
  let totalAmount = "0 ج.م";
  if (order.finalTotal && typeof order.finalTotal === 'number') {
    totalAmount = order.finalTotal.toLocaleString('ar-EG') + ' ج.م';
  } else if (order.total) {
    totalAmount = order.total + ' ج.م';
  }

  const paymentMethodText = order.paymentMethod === 'cod' ? 'الدفع عند الاستلام' : 'الدفع الإلكتروني';

  card.innerHTML = `
    <div class="order-header">
      <div>
        <strong>رقم الطلب: #${order.orderNumber || orderId.substring(0, 8)}</strong>
        <div>تاريخ الطلب: ${orderDate}</div>
      </div>
      <div class="order-status ${statusClass}">
        ${statusText}
      </div>
    </div>
    <div class="order-details">
      <div><strong>عنوان التوصيل:</strong><div>${order.address || order.deliveryAddress || "-"}</div></div>
      <div><strong>طريقة الدفع:</strong><div>${paymentMethodText}</div></div>
      <div><strong>إجمالي الطلب:</strong><div>${totalAmount}</div></div>
      <div><strong>رسوم التوصيل:</strong><div>${order.deliveryFee || 0} ج.م</div></div>
    </div>
    <div class="order-items">
      <h4>المنتجات:</h4>
      ${formatOrderItems(order.items || [])}
    </div>
  `;

  return card;
}

function formatOrderItems(items) {
  if (!items || items.length === 0) {
    return '<div class="order-item"><span>لا توجد تفاصيل للمنتجات</span></div>';
  }

  return items.map(item => {
    const itemPrice = item.price ? item.price.toLocaleString('ar-EG') + ' ج.م' : '0 ج.م';
    const itemQty = item.qty || item.quantity || 1;
    const itemUnit = item.unit || "حبة";
    const itemName = item.name || item.title || "منتج غير محدد";

    return `
      <div class="order-item">
        <span>${itemName} - ${itemQty} ${itemUnit}</span>
        <span>${itemPrice}</span>
      </div>
    `;
  }).join("");
}

// مراقبة حالة المستخدم
onAuthStateChanged(auth, async (user) => {
  console.log('Auth state changed:', user ? 'User logged in' : 'User logged out');
  
  if (!user) {
    if (!redirectInProgress && window.location.pathname !== '/signup&signup.html') {
      redirectInProgress = true;
      console.log('User not authenticated, redirecting to login...');
      
      setTimeout(() => {
        if (!auth.currentUser) {
          sessionStorage.setItem('redirectFrom', 'profile');
          window.location.href = "signup&signup.html";
        }
      }, 1000);
    }
    return;
  }

  currentUser = user;
  console.log('Current user:', currentUser.email);

  const justLoggedIn = sessionStorage.getItem('justLoggedIn');
  if (justLoggedIn) {
    sessionStorage.removeItem('justLoggedIn');
    console.log('Welcome back message could be shown here');
  }

  document.body.classList.add('loading');

  try {
    await Promise.all([
      loadUserData(user),
      loadOrders(user),
      loadNotifications(user)
    ]);
    
    console.log('Profile data loaded successfully');
  } catch (error) {
    console.error("Error loading profile data:", error);
    showMessage('personalInfoMessage', 'حدث خطأ في تحميل البيانات: ' + getErrorMessage(error.code), 'error');
  } finally {
    document.body.classList.remove('loading');
    redirectInProgress = false;
  }
});

// تسجيل الخروج
window.logout = async function() {
  if (redirectInProgress) return;
  
  try {
    redirectInProgress = true;
    console.log('Logging out user...');
    
    currentUser = null;
    userData = null;
    isDataLoaded = false;
    sessionStorage.clear();
    
    await signOut(auth);
    
    console.log('User logged out successfully');
    window.location.href = "signup&signup.html?logout=true";
  } catch (error) {
    console.error("Logout error:", error);
    alert("حدث خطأ أثناء تسجيل الخروج: " + getErrorMessage(error.code));
    redirectInProgress = false;
  }
};

// حفظ المعلومات الشخصية
document.getElementById("personalInfoForm")?.addEventListener("submit", async (e) => {
  e.preventDefault();
  
  if (!currentUser || !isDataLoaded) {
    showMessage('personalInfoMessage', 'يرجى انتظار تحميل البيانات', 'error');
    return;
  }

  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
  submitBtn.disabled = true;
  
  try {
    const name = document.getElementById("settingsName").value.trim();
    const email = document.getElementById("settingsEmail").value.trim();
    const phone = document.getElementById("settingsPhone").value.trim();

    if (!name || name.length < 2) {
      throw new Error('يرجى إدخال اسم صحيح (حرفين على الأقل)');
    }

    if (!email || !email.includes('@')) {
      throw new Error('يرجى إدخال بريد إلكتروني صحيح');
    }

    await updateProfile(currentUser, {
      displayName: name
    });

    const userRef = doc(db, "users", currentUser.uid);
    const updateData = {
      name: name,
      email: email,
      phone: phone,
      lastUpdatedAt: serverTimestamp()
    };

    await updateDoc(userRef, updateData);

    if (userData) {
      userData.name = name;
      userData.email = email;
      userData.phone = phone;
    }

    updateElementText("userName", name);
    updateElementText("profileName", name);
    updateElementText("profileEmail", email);
    updateElementText("profilePhone", phone);

    showMessage('personalInfoMessage', 'تم حفظ التغييرات بنجاح', 'success');
    console.log('Personal info updated successfully');
  } catch (error) {
    console.error("Error updating personal info:", error);
    showMessage('personalInfoMessage', error.message || 'حدث خطأ أثناء حفظ التغييرات', 'error');
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});

// حفظ إعدادات التوصيل
document.getElementById("deliverySettingsForm")?.addEventListener("submit", async (e) => {
  e.preventDefault();
  
  if (!currentUser || !isDataLoaded) {
    showMessage('deliverySettingsMessage', 'يرجى انتظار تحميل البيانات', 'error');
    return;
  }

  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
  submitBtn.disabled = true;

  try {
    const address = document.getElementById("settingsAddress").value.trim();
    const deliveryPref = document.getElementById("settingsDeliveryPref").value;

    const userRef = doc(db, "users", currentUser.uid);
    const updateData = {
      addresses: {
        primary: address,
        secondary: userData?.addresses?.secondary || ""
      },
      preferences: {
        ...userData?.preferences,
        deliveryTime: deliveryPref
      },
      lastUpdatedAt: serverTimestamp()
    };

    await updateDoc(userRef, updateData);

    if (userData) {
      userData.addresses = updateData.addresses;
      userData.preferences = updateData.preferences;
    }

    updateElementText("profileAddress", address || "-");

    showMessage('deliverySettingsMessage', 'تم حفظ إعدادات التوصيل بنجاح', 'success');
    console.log('Delivery settings updated successfully');
  } catch (error) {
    console.error("Error updating delivery settings:", error);
    showMessage('deliverySettingsMessage', 'حدث خطأ أثناء حفظ الإعدادات: ' + getErrorMessage(error.code), 'error');
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});

// حفظ إعدادات الإشعارات
document.getElementById("notificationSettingsForm")?.addEventListener("submit", async (e) => {
  e.preventDefault();
  
  if (!currentUser || !isDataLoaded) {
    showMessage('notificationSettingsMessage', 'يرجى انتظار تحميل البيانات', 'error');
    return;
  }

  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري الحفظ...';
  submitBtn.disabled = true;

  try {
    const notifications = {
      promotional: document.getElementById("notifyPromotional").checked,
      orderStatus: document.getElementById("notifyOrderStatus").checked
    };

    const userRef = doc(db, "users", currentUser.uid);
    const updateData = {
      preferences: {
        ...userData?.preferences,
        notifications: notifications
      },
      lastUpdatedAt: serverTimestamp()
    };

    await updateDoc(userRef, updateData);

    if (userData) {
      userData.preferences = updateData.preferences;
    }

    showMessage('notificationSettingsMessage', 'تم حفظ إعدادات الإشعارات بنجاح', 'success');
    console.log('Notification settings updated successfully');
  } catch (error) {
    console.error("Error updating notification settings:", error);
    showMessage('notificationSettingsMessage', 'حدث خطأ أثناء حفظ الإعدادات: ' + getErrorMessage(error.code), 'error');
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});

// التنقل بين التابات
document.addEventListener('DOMContentLoaded', function() {
  console.log('ProfilePage DOM loaded');
  
  const tabs = document.querySelectorAll('.tab');
  const tabContents = document.querySelectorAll('.tab-content');
  
  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const targetTab = tab.getAttribute('data-tab');
      
      tabs.forEach(t => t.classList.remove('active'));
      tabContents.forEach(tc => tc.classList.remove('active'));
      
      tab.classList.add('active');
      const targetContent = document.getElementById(targetTab);
      if (targetContent) {
        targetContent.classList.add('active');
      }
      
      console.log('Tab switched to:', targetTab);
    });
  });
});

console.log('ProfilePage script loaded successfully ✅');
</script>
</body>
</html>
